/* Pentatype by Frosetrain */

// This line contains some Shakespeare quotes that I gathered
// Please ignore the fact that this line is 10971 characters long
// prettier-ignore
let collection = [{"source":"Flavius, Julius Caesar 1.1","quote":"Hence! home, you idle creatures get you home:\nIs this a holiday? what! know you not,\nBeing mechanical, you ought not walk\nUpon a labouring day without the sign\nOf your profession? Speak, what trade art thou?\n"},{"source":"Soothsayer, Julius Caesar 1.2","quote":"Beware the Ides of March.\n"},{"source":"Caesar, Julius Caesar 1.2","quote":"He is a dreamer; let us leave him: pass.\n"},{"source":"Cassius, Julius Caesar 1.2","quote":"Why, man, he doth bestride the narrow world\nLike a Colossus, and we petty men\nWalk under his huge legs and peep about\nTo find ourselves dishonourable graves.\nMen at some time are masters of their fates:\nThe fault, dear Brutus, is not in our stars,\nBut in ourselves, that we are underlings.\n"},{"source":"Cassius, Julius Caesar 1.2","quote":"Why, man, he doth bestride the narrow world\nLike a Colossus, and we petty men\nWalk under his huge legs and peep about\nTo find ourselves dishonourable graves.\n"},{"source":"Cassius, Julius Caesar 1.2","quote":"Men at some time are masters of their fates.\nThe fault, dear Brutus, is not in our stars\nBut in ourselves, that we are underlings.\n"},{"source":"Caesar, Julius Caesar 1.2","quote":"Yond Cassius has a lean and hungry look;\nHe thinks too much: such men are dangerous.\n"},{"source":"Brutus, Julius Caesar 2.1","quote":"And therefore think him as a serpent's egg\nWhich, hatch'd, would, as his kind, grow mischievous,\nAnd kill him in the shell.\n"},{"source":"Brutus, Julius Caesar 2.1","quote":"O conspiracy,\nShamest thou to show thy dangerous brow by night,\nWhen evils are most free? O, then by day\nWhere wilt thou find a cavern dark enough\nTo mask thy monstrous visage? Seek none, conspiracy;\nHide it in smiles and affability:\nFor if thou path, thy native semblance on,\nNot Erebus itself were dim enough\nTo hide thee from prevention.\n"},{"source":"Calpurnia, Julius Caesar 2.2","quote":"When beggars die, there are no comets seen;\nThe heavens themselves blaze forth the death of princes.\n"},{"source":"Caesar, Julius Caesar 2.2","quote":"Cowards die many times before their deaths;\nThe valiant never taste of death but once.\n"},{"source":"Caesar, Julius Caesar 2.2","quote":"Cowards die many times before their deaths;\nThe valiant never taste of death but once.\nOf all the wonders that I yet have heard.\nIt seems to me most strange that men should fear;\nSeeing that death, a necessary end,\nWill come when it will come.\n"},{"source":"Caesar, Julius Caesar 2.2","quote":"Death, a necessary end,\nWill come when it will come.\n"},{"source":"Caesar, Julius Caesar 3.1","quote":"I could be well moved, if I were as you:\nIf I could pray to move, prayers would move me:\nBut I am constant as the northern star,\nOf whose true-fix'd and resting quality\nThere is no fellow in the firmament.\n"},{"source":"Caesar, Julius Caesar 3.1","quote":"I could be well moved, if I were as you:\nIf I could pray to move, prayers would move me.\n"},{"source":"Caesar, Julius Caesar 3.1","quote":"But I am constant as the northern star,\nOf whose true-fix'd and resting quality\nThere is no fellow in the firmament.\n"},{"source":"Caesar, Julius Caesar 3.1","quote":"Et tu, Brute? Then fall, Caesar.\n"},{"source":"Cinna, Julius Caesar 3.1","quote":"Liberty! Freedom! Tyranny is dead!\nRun hence, proclaim, cry it about the streets.\n"},{"source":"Brutus, Julius Caesar 3.2","quote":"Not that I loved Caesar less, but that I loved Rome more.\n"},{"source":"Brutus, Julius Caesar 3.2","quote":"As Caesar loved me, I weep for him;\nas he was fortunate, I rejoice at it; as he was\nvaliant, I honour him: but, as he was ambitious, I\nslew him.\n"},{"source":"Antony, Julius Caesar 3.2","quote":"Friends, Romans, countrymen, lend me your ears.\n"},{"source":"Antony, Julius Caesar 3.2","quote":"Friends, Romans, countrymen, lend me your ears;\nI come to bury Caesar, not to praise him.\nThe evil that men do lives after them;\nThe good is oft interred with their bones;\nSo let it be with Caesar. \n"},{"source":"Brutus, Julius Caesar 4.3","quote":"Remember March, the ides of March remember.\n"},{"source":"Cassius, Julius Caesar 5.3","quote":"Come down, behold no more.\nO, coward that I am, to live so long,\nTo see my best friend ta'en before my face!\n"},{"source":"Cassius, Julius Caesar 5.3","quote":"Caesar, thou art revenged,\nEven with the sword that kill'd thee.\n"},{"source":"Brutus, Julius Caesar 5.3","quote":"Are yet two Romans living such as these?\n"},{"source":"Brutus, Julius Caesar 5.5","quote":"Caesar, now be still:\nI kill'd not thee with half so good a will.\n"},{"source":"Antony, Julius Caesar 5.5","quote":"His life was gentle, and the elements\nSo mix'd in him that Nature might stand up\nAnd say to all the world 'This was a man!'\n"},{"source":"Octavius, Julius Caesar 5.5","quote":"So call the field to rest; and let's away,\nTo part the glories of this happy day.\n"},{"source":"Witches, Macbeth 1.1","quote":"When shall we three meet again?\nIn thunder, lightning, or in rain?\nWhen the hurly-burly's done,\nWhen the battle's lost and won.\nThat will be ere the set of sun.\nWhere the place?\nUpon the heath.\nThere to meet with Macbeth.\n"},{"source":"Witches, Macbeth 1.1","quote":"Fair is foul, and foul is fair:\nHover through the fog and filthy air.\n"},{"source":"Macbeth, Macbeth 1.1","quote":"If it were done when 'tis done, then 'twere well\nIt were done quickly. \n"},{"source":"Lady Macbeth, Macbeth 1.5","quote":"Come, you spirits\nThat tend on mortal thoughts, unsex me here,\nAnd fill me from the crown to the toe top-full\nOf direst cruelty! make thick my blood;\nStop up the access and passage to remorse,\nThat no compunctious visitings of nature\nShake my fell purpose, nor keep peace between\nThe effect and it! Come to my woman's breasts,\nAnd take my milk for gall, you murdering ministers,\nWherever in your sightless substances\nYou wait on nature's mischief! Come, thick night,\nAnd pall thee in the dunnest smoke of hell,\nThat my keen knife see not the wound it makes,\nNor heaven peep through the blanket of the dark,\nTo cry 'Hold, hold!'\n"},{"source":"Lady Macbeth, Macbeth 1.5","quote":"Come, you spirits\nThat tend on mortal thoughts, unsex me here,\nAnd fill me from the crown to the toe top-full\nOf direst cruelty!\n"},{"source":"Macbeth, Macbeth 2.1","quote":"Is this a dagger which I see before me,\nThe handle toward my hand? Come, let me clutch thee.\nI have thee not, and yet I see thee still.\n"},{"source":"Lady Macbeth, Macbeth 2.2","quote":"That which hath made them drunk hath made me bold;\nWhat hath quench'd them hath given me fire.\n"},{"source":"Macbeth, Macbeth 2.2","quote":"Methought I heard a voice cry 'Sleep no more!\nMacbeth does murder sleep', the innocent sleep,\nSleep that knits up the ravell'd sleeve of care,\nThe death of each day's life, sore labour's bath,\nBalm of hurt minds, great nature's second course,\nChief nourisher in life's feast.\n"},{"source":"Macbeth, Macbeth 2.2","quote":"Will all great Neptune's ocean wash this blood\nClean from my hand?\n"},{"source":"Macbeth, Macbeth 3.4","quote":"It will have blood; they say, blood will have blood.\n"},{"source":"Witches, Macbeth 4.1","quote":"Double, double toil and trouble;\nFire burn, and cauldron bubble.\n"},{"source":"Second Witch, Macbeth 4.1","quote":"By the pricking of my thumbs,\nSomething wicked this way comes.\n"},{"source":"Third Apparition, Macbeth 4.1","quote":"Macbeth shall never vanquish'd be until\nGreat Birnam wood to high Dunsinane hill\nShall come against him.\n"},{"source":"Lady Macbeth, Macbeth 5.1","quote":"What's done cannot be undone.\n"},{"source":"Macduff, Macbeth 5.7","quote":"And let the angel whom thou still hast served\nTell thee, Macduff was from his mother's womb\nUntimely ripp'd.\n"},{"source":"Macbeth, Macbeth 5.7","quote":"Lay on, Macduff,\nAnd damn'd be him that first cries, 'Hold, enough!'\n"},{"source":"Hamlet, Hamlet 3.1","quote":"To be, or not to be, that is the question,\nWhether 'tis nobler in the mind to suffer\nThe slings and arrows of outrageous fortune,\nOr to take arms against a sea of troubles,\nAnd by opposing end them? To die: to sleep;\n"},{"source":"Romeo and Juliet, Prologue","quote":"Two households, both alike in dignity,\nIn fair Verona, where we lay our scene,\nFrom ancient grudge break to new mutiny,\nWhere civil blood makes civil hands unclean.\nFrom forth the fatal loins of these two foes\nA pair of star-cross'd lovers take their life;\nWhose misadventured piteous overthrows\nDo with their death bury their parents' strife.\nThe fearful passage of their death-mark'd love,\nAnd the continuance of their parents' rage,\nWhich, but their children's end, nought could remove,\nIs now the two hours' traffic of our stage;\nThe which if you with patient ears attend,\nWhat here shall miss, our toil shall strive to mend.\n\n"},{"source":"Romeo, Romeo and Juliet 2.1","quote":"But, soft! what light through yonder window breaks?\nIt is the east, and Juliet is the sun.\nArise, fair sun, and kill the envious moon,\nWho is already sick and pale with grief,\nThat thou her maid art far more fair than sherBut, soft! what light through yonder window breaks?\nIt is the east, and Juliet is the sun.\nArise, fair sun, and kill the envious moon,\nWho is already sick and pale with grief,\nThat thou her maid art far more fair than she:\n"},{"source":"Romeo, Romeo and Juliet 2.1","quote":"But, soft! what light through yonder window breaks?\n"},{"source":"Juliet, Romeo and Juliet 2.1","quote":"O Romeo, Romeo! wherefore art thou Romeo?\nDeny thy father and refuse thy name;\nOr, if thou wilt not, be but sworn my love,\nAnd I'll no longer be a Capulet.\n\n"},{"source":"Juliet, Romet and Juliet 2.1","quote":"O Romeo, Romeo! wherefore art thou Romeo?\n"},{"source":"Juliet, Romeo and Juliet 2.1","quote":"that which we call a rose\nBy any other name would smell as sweet;\n"},{"source":"Juliet, Romeo and Juliet 4.3","quote":"Romeo, I come! this do I drink to thee.\n"},{"source":"Romeo, Romeo and Juliet 5.3","quote":"O true apothecary!\nThy drugs are quick. Thus with a kiss I die.\n"},{"source":"Juliet, Romeo and Juliet 5.3","quote":"O happy dagger!\nThis is thy sheath;\nthere rust, and let me die.\n"},{"source":"Sonnet 18","quote":"Shall I compare thee to a summer's day?\nThou art more lovely and more temperate:\nRough winds do shake the darling buds of May,\nAnd summer's lease hath all too short a date;\nSometime too hot the eye of heaven shines,\nAnd often is his gold complexion dimm'd;\nAnd every fair from fair sometime declines,\nBy chance or nature's changing course untrimm'd;\nBut thy eternal summer shall not fade,\nNor lose possession of that fair thou ow'st;\nNor shall death brag thou wander'st in his shade,\nWhen in eternal lines to time thou grow'st:\nSo long as men can breathe or eyes can see,\nSo long lives this, and this gives life to thee.\n"}]

let twGray = {
    50: "#f9fafb",
    100: "#f3f4f6",
    200: "#e5e7eb",
    300: "#d1d5db",
    400: "#9ca3af",
    500: "#6b7280",
    600: "#4b5563",
    700: "#374151",
    800: "#1f2937",
    900: "#111827",
    950: "#030712",
};

let gray = {
    dark: {
        bg: twGray[900],
        fg: twGray[100],
    },
    light: {
        bg: twGray[100],
        fg: twGray[900],
    },
};

let currentLine;
let currentChar;
let typed;
let quote;
let source;
let otherLines;
let lines;
let quoteLength;
let lineId;
let otherLinesBox;
let theme;
let timeStart;

function getRandomQuote() {
    return collection[Math.floor(Math.random() * 56)];
}

function drawUI() {
    removeElements();
    createCanvas(windowWidth, windowHeight - 60);
    newTheme = localStorage.theme;
    background(gray[newTheme]["bg"]);
    theme = newTheme;
    bigDiv = createDiv();
    bigDiv.class("flex w-screen items-center justify-center");
    bigDiv.style("height", windowHeight - 60 + "px");
    bigDiv.position(0, 60);
    typingDiv = createDiv();
    typingDiv.parent(bigDiv);
    typingDiv.class("m-8");
    currentLineBox = createElement(
        "p",
        "<span class=text-blue-500>> </span>" + currentLine
    );
    currentLineBox.parent(typingDiv);
    currentLineBox.class(
        "p-2 my-2 rounded text-center text-xl font-mono text-gray-400 dark:text-gray-500 bg-gray-200 dark:bg-gray-800"
    );
    otherLinesBox = createElement("p", otherLines);
    otherLinesBox.parent(typingDiv);
    otherLinesBox.class(
        "whitespace-pre-line my-2 text-center text-md font-mono text-gray-400 dark:text-gray-600"
    );
    sourceBox = createElement("p", "- " + source);
    sourceBox.parent(typingDiv);
    sourceBox.class("py-4 text-right italic text-gray-500");
}

function setup() {
    lineId = 0;
    currentChar = 0;
    typed = "";
    let got = getRandomQuote();
    quote = got["quote"];
    source = got["source"];
    otherLines = quote.substring(quote.indexOf("\n") + 1);
    if (quote[quote.length - 1] == "\n") {
        quote = quote.substring(0, quote.length - 1);
    }
    lines = quote.split("\n");
    currentLine = lines[0];
    quoteLength = lines.length;
    drawUI();
}

function windowResized() {
    drawUI();
}

function showTyping() {
    let firstError = currentChar;
    for (let i = 0; i < typed.length; i++) {
        if (typed[i] != currentLine[i]) {
            firstError = i;
            break;
        }
    }
    currentLineBox.html(
        "<span class=text-blue-500>> </span>" +
            "<span class='text-gray-900 dark:text-gray-100'>" +
            typed.substring(0, firstError) + // white
            "</span><span class='text-red-500'>" +
            typed.substring(firstError, currentChar) + // red
            "</span>" +
            currentLine.substring(currentChar, currentLine.length) // gray
    );
}

function success(timeTaken) {
    removeElements();
    let wpm = ((quote.length / timeTaken) * 60000) / 5;
    fill(gray[theme]["fg"]);
    text(`Congratulations, ${round(wpm)} wpm`, 100, 100);
}

function keyTyped() {
    if (currentChar == 0 && lineId == 0) {
        timeStart = Date.now();
    }
    typed += key;
    currentChar++;
    showTyping();
    if (typed == currentLine) {
        if (lineId == quoteLength - 1) {
            success(Date.now() - timeStart);
        }
        lineId++;
        lines.shift();
        currentLine = lines[0];
        typed = "";
        currentChar = 0;
        indexOfNewline = otherLines.indexOf("\n");
        if (indexOfNewline == -1) {
            otherLines = "";
        } else {
            otherLines = otherLines.substring(otherLines.indexOf("\n") + 1);
        }
        currentLineBox.html(
            "<span class=text-blue-500>> </span>" + currentLine
        );
        otherLinesBox.html(otherLines);
    }
}

function keyPressed() {
    if (keyCode == BACKSPACE && currentChar > 0) {
        typed = typed.substring(0, typed.length - 1);
        currentChar--;
        showTyping();
    }
    if (keyCode == CONTROL) {
        setup()
    }
}

function draw() {
    // fill("black");
    // rect(100, 80, 20, 20);
    // fill("white");
    // textSize(20);
    // text(currentChar, 100, 100);
    newTheme = localStorage.theme;
    if (theme != newTheme) {
        background(gray[newTheme]["bg"]);
        theme = newTheme;
    }
}
